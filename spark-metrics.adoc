== [[MetricsSystem]] Metrics System

Spark uses http://metrics.dropwizard.io/[Metrics] - a Java library to measure the behaviour of the components.

`org.apache.spark.metrics.source.Source` is the top-level class for the metric registries in Spark. Sources expose their internal status.

Spark uses http://metrics.dropwizard.io/3.1.0/[Metrics 3.1.0].

Metrics System is available at http://localhost:4040/metrics/json/ (for the default setup).

Enable `org.apache.spark.metrics.sink.JmxSink` in `conf/metrics.properties` and use jconsole to access Spark metrics through JMX.

```
*.sink.jmx.class=org.apache.spark.metrics.sink.JmxSink
```

.jconsole and JmxSink in spark-shell
image::images/spark-metrics-jconsole.png[align="center"]

=== [[creating-instance]] Creating `MetricsSystem` Instance

When created, `MetricsSystem` link:spark-metrics-MetricsConfig.adoc#creating-instance[creates a `MetricsConfig`] and link:spark-metrics-MetricsConfig.adoc#initialize[initializes] it immediately.

=== [[createMetricsSystem]] `createMetricsSystem` Method

[source, scala]
----
createMetricsSystem(
  instance: String,
  conf: SparkConf,
  securityMgr: SecurityManager): MetricsSystem
----

`createMetricsSystem` <<creating-instance, creates a `MetricsSystem`>>.

NOTE: `createMetricsSystem` is executed when a link:spark-sparkenv.adoc#create[`SparkEnv` is created] for the driver and executors.

=== [[start]] `start` Method

CAUTION: FIXME

=== [[registerSource]] `registerSource` Method

CAUTION: FIXME

=== [[report]] `report` Method

CAUTION: FIXME

=== Executors

A non-local executor registers executor source.

FIXME See `Executor` class.

=== Master

```
$ http http://192.168.1.4:8080/metrics/master/json/path
HTTP/1.1 200 OK
Cache-Control: no-cache, no-store, must-revalidate
Content-Length: 207
Content-Type: text/json;charset=UTF-8
Server: Jetty(8.y.z-SNAPSHOT)
X-Frame-Options: SAMEORIGIN

{
    "counters": {},
    "gauges": {
        "master.aliveWorkers": {
            "value": 0
        },
        "master.apps": {
            "value": 0
        },
        "master.waitingApps": {
            "value": 0
        },
        "master.workers": {
            "value": 0
        }
    },
    "histograms": {},
    "meters": {},
    "timers": {},
    "version": "3.0.0"
}
```
