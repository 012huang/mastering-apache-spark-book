== [[StorageStatusListener]] StorageStatusListener -- Spark Listener To Track BlockManagers

`StorageStatusListener` is a link:spark-SparkListener.adoc[SparkListener] that link:spark-webui-SparkUI.adoc[web UI] uses to track status of every link:spark-blockmanager.adoc[BlockManager] in a Spark application.

NOTE: `StorageStatusListener` is created and registered when `SparkUI` link:spark-webui-SparkUI.adoc#create[is created]. It is later used to create link:spark-webui-executors-ExecutorsListener.adoc[ExecutorsListener] and link:spark-webui-StorageListener.adoc[StorageListener] Spark listeners.

.StorageStatusListener Event Handlers
[cols="1,2",options="header",width="100%"]
|===
| Event Handler
| Description

| [[onBlockManagerAdded]] `onBlockManagerAdded`
| Adds an executor id and link:spark-blockmanager-StorageStatus.adoc[StorageStatus] (with link:spark-blockmanager.adoc[BlockManager] and maximum memory on the executor) to <<executorIdToStorageStatus, executorIdToStorageStatus>> internal registry.

Removes any other `BlockManager` that may have been registered for the executor earlier in <<deadExecutorStorageStatus, deadExecutorStorageStatus>> internal registry.

| `onBlockManagerRemoved`
| Removes an executor from <<executorIdToStorageStatus, executorIdToStorageStatus>> internal registry and adds the removed link:spark-blockmanager-StorageStatus.adoc[StorageStatus] to <<deadExecutorStorageStatus, deadExecutorStorageStatus>> internal registry.

Removes the oldest link:spark-blockmanager-StorageStatus.adoc[StorageStatus] when the number of entries in <<deadExecutorStorageStatus, deadExecutorStorageStatus>> is bigger than link:spark-webui.adoc#spark_ui_retainedDeadExecutors[spark.ui.retainedDeadExecutors].

| `onBlockUpdated`
| Updates link:spark-blockmanager-StorageStatus.adoc[StorageStatus] for an executor in <<executorIdToStorageStatus, executorIdToStorageStatus>> internal registry, i.e. removes a block for link:spark-rdd-StorageLevel.adoc[`NONE` storage level] and updates otherwise.

| `onUnpersistRDD`
| Removes the RDD blocks for the unpersisted `rddId` from every link:spark-blockmanager-StorageStatus.adoc[StorageStatus] in <<executorIdToStorageStatus, executorIdToStorageStatus>> internal registry.
|===

[[internal-registries]]
.StorageStatusListener's Internal Registries and Counters
[cols="1,2",options="header",width="100%"]
|===
| Name
| Description

| [[executorIdToStorageStatus]] `executorIdToStorageStatus`
| Lookup table of link:spark-blockmanager-StorageStatus.adoc[StorageStatus] per executor or the driver.

Used when...FIXME

| [[deadExecutorStorageStatus]] `deadExecutorStorageStatus`
| Collection of link:spark-blockmanager-StorageStatus.adoc[StorageStatus] of removed/inactive `BlockManagers`.

Used when...FIXME
|===
