== Thrift JDBC/ODBC Server -- Spark Thrift Server (STS)

*Thrift JDBC/ODBC Server* (aka _Spark Thrift Server_ or _STS_) is Spark SQL's port of https://cwiki.apache.org/confluence/display/Hive/HiveServer2+Overview[Apache Hive's HiveServer2] that allows JDBC/ODBC clients for executing SQL queries on Apache Spark. It is a Spark standalone application that you start using <<start-thriftserver, `start-thriftserver.sh`>> and stop using <<stop-thriftserver, `stop-thriftserver.sh`>> shell scripts.

Spark Thrift Server has its own tab in web UI -- <<webui, JDBC/ODBC Server>> available at `/sqlserver`.

.Spark Thrift Server's web UI
image::images/spark-thriftserver-webui.png[align="center"]

Thrift JDBC/ODBC Server can work in <<transport-mode, HTTP or binary transport modes>>. Use <<beeline, beeline command-line tool>> to connect to Thrift JDBC/ODBC Server.

Thrift JDBC/ODBC Server extends spark-submit's command-line options with `--hiveconf [prop=value]`.

Thrift Server is implemented as `org.apache.spark.sql.hive.thriftserver.HiveThriftServer2` standalone application.

[TIP]
====
Enable `INFO` or `DEBUG` logging levels for `org.apache.spark.sql.hive.thriftserver` and `org.apache.hive.service.server` loggers to see what happens inside.

Add the following line to `conf/log4j.properties`:

```
log4j.logger.org.apache.spark.sql.hive.thriftserver=DEBUG
log4j.logger.org.apache.hive.service.server=INFO
```

Refer to link:spark-logging.adoc[Logging].
====

=== [[beeline]] Beeline Command-Line Tool

`beeline` is a command-line tool to connect to Thrift JDBC/ODBC Server.

```
$ ./bin/beeline
Beeline version 1.2.1.spark2 by Apache Hive
beeline>
```

You can connect to Thrift JDBC/ODBC Server using `connect` command as follows:

```
beeline> !connect jdbc:hive2://localhost:10000
```

In non-secure mode, simply enter the username on your machine and a blank password.

```
beeline> !connect jdbc:hive2://localhost:10000
Connecting to jdbc:hive2://localhost:10000
Enter username for jdbc:hive2://localhost:10000: jacek
Enter password for jdbc:hive2://localhost:10000: [press ENTER]
Connected to: Spark SQL (version 2.1.0-SNAPSHOT)
Driver: Hive JDBC (version 1.2.1.spark2)
Transaction isolation: TRANSACTION_REPEATABLE_READ
0: jdbc:hive2://localhost:10000>
```

=== [[webui]][[ThriftServerTab]] `ThriftServerTab` -- web UI's Tab for Spark Thrift Server

`ThriftServerTab` is...FIXME

CAUTION: FIXME Describe me

=== [[start-thriftserver]] Starting Thrift JDBC/ODBC Server -- `start-thriftserver.sh`

You start Thrift JDBC/ODBC Server using `./sbin/start-thriftserver.sh` shell script.

With `INFO` logging level enabled, you should see the following messages in the logs:

```
INFO HiveThriftServer2: Started daemon with process name: 16633@japila.local
INFO HiveThriftServer2: Starting SparkContext
...
INFO HiveThriftServer2: HiveThriftServer2 started
```

=== [[stop-thriftserver]] Stopping Thrift JDBC/ODBC Server -- `stop-thriftserver.sh`

You can stop a running instance of Thrift JDBC/ODBC Server using `./sbin/stop-thriftserver.sh` shell script.

With `DEBUG` logging level enabled, you should see the following messages in the logs:

```
ERROR HiveThriftServer2: RECEIVED SIGNAL TERM
DEBUG SparkSQLEnv: Shutting down Spark SQL Environment
INFO HiveServer2: Shutting down HiveServer2
INFO BlockManager: BlockManager stopped
INFO SparkContext: Successfully stopped SparkContext
```

TIP: You can also send `SIGTERM` signal to the process of Thrift JDBC/ODBC Server, i.e. `kill [PID]` that triggers the same sequence of shutdown steps as `stop-thriftserver.sh`.

=== [[transport-mode]] Transport Mode

`HIVE_SERVER2_TRANSPORT_MODE=http` or `hive.server2.transport.mode` (default: `binary`) is the transport mode of HiveServer2. It can be `binary` (default) or `http`.

=== [[main]] `main` method

Thrift JDBC/ODBC Server is a Spark standalone application that you...

CAUTION: FIXME

=== [[HiveThriftServer2Listener]] HiveThriftServer2Listener

CAUTION: FIXME
